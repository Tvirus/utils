#include <stdio.h>




static const unsigned char u2a_map[128] =
{
      1,  1,  2,  2,  3,  3,  4,  4,
      5,  5,  6,  6,  7,  7,  8,  8,
      9, 10, 11, 12, 13, 14, 15, 16,
     17, 18, 19, 20, 21, 22, 23, 24,
     25, 27, 29, 31, 33, 34, 35, 36,
     37, 38, 39, 40, 41, 42, 43, 44,
     46, 48, 49, 50, 51, 52, 53, 54,
     55, 56, 57, 58, 59, 60, 61, 62,
     64, 65, 66, 67, 68, 69, 70, 71,
     72, 73, 74, 75, 76, 77, 78, 79,
     81, 82, 83, 84, 85, 86, 87, 88,
     89, 90, 91, 92, 93, 94, 95, 96,
     97, 98, 99,100,101,102,103,104,
    105,106,107,108,109,110,111,112,
    113,114,115,116,117,118,119,120,
    121,122,123,124,125,126,127,128
};
static const unsigned char a2u_map[128] =
{
      1,  3,  5,  7,  9, 11, 13, 15,
     16, 17, 18, 19, 20, 21, 22, 23,
     24, 25, 26, 27, 28, 29, 30, 31,
     32, 32, 33, 33, 34, 34, 35, 35,
     36, 37, 38, 39, 40, 41, 42, 43,
     44, 45, 46, 47, 48, 48, 49, 49,
     50, 51, 52, 53, 54, 55, 56, 57,
     58, 59, 60, 61, 62, 63, 64, 64,
     65, 66, 67, 68, 69, 70, 71, 72,
     73, 74, 75, 76, 77, 78, 79, 79,
     80, 81, 82, 83, 84, 85, 86, 87,
     88, 89, 90, 91, 92, 93, 94, 95,
     96, 97, 98, 99,100,101,102,103,
    104,105,106,107,108,109,110,111,
    112,113,114,115,116,117,118,119,
    120,121,122,123,124,125,126,127
};

static const short a2l_map[256] =
{
     -5504, -5248, -6016, -5760, -4480, -4224, -4992, -4736,
     -7552, -7296, -8064, -7808, -6528, -6272, -7040, -6784,
     -2752, -2624, -3008, -2880, -2240, -2112, -2496, -2368,
     -3776, -3648, -4032, -3904, -3264, -3136, -3520, -3392,
    -22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,
    -30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,
    -11008,-10496,-12032,-11520, -8960, -8448, -9984, -9472,
    -15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,
      -344,  -328,  -376,  -360,  -280,  -264,  -312,  -296,
      -472,  -456,  -504,  -488,  -408,  -392,  -440,  -424,
       -88,   -72,  -120,  -104,   -24,    -8,   -56,   -40,
      -216,  -200,  -248,  -232,  -152,  -136,  -184,  -168,
     -1376, -1312, -1504, -1440, -1120, -1056, -1248, -1184,
     -1888, -1824, -2016, -1952, -1632, -1568, -1760, -1696,
      -688,  -656,  -752,  -720,  -560,  -528,  -624,  -592,
      -944,  -912, -1008,  -976,  -816,  -784,  -880,  -848,
      5504,  5248,  6016,  5760,  4480,  4224,  4992,  4736,
      7552,  7296,  8064,  7808,  6528,  6272,  7040,  6784,
      2752,  2624,  3008,  2880,  2240,  2112,  2496,  2368,
      3776,  3648,  4032,  3904,  3264,  3136,  3520,  3392,
     22016, 20992, 24064, 23040, 17920, 16896, 19968, 18944,
     30208, 29184, 32256, 31232, 26112, 25088, 28160, 27136,
     11008, 10496, 12032, 11520,  8960,  8448,  9984,  9472,
     15104, 14592, 16128, 15616, 13056, 12544, 14080, 13568,
       344,   328,   376,   360,   280,   264,   312,   296,
       472,   456,   504,   488,   408,   392,   440,   424,
        88,    72,   120,   104,    24,     8,    56,    40,
       216,   200,   248,   232,   152,   136,   184,   168,
      1376,  1312,  1504,  1440,  1120,  1056,  1248,  1184,
      1888,  1824,  2016,  1952,  1632,  1568,  1760,  1696,
       688,   656,   752,   720,   560,   528,   624,   592,
       944,   912,  1008,   976,   816,   784,   880,   848
};

static const short u2l_map[256] =
{
    -32124,-31100,-30076,-29052,-28028,-27004,-25980,-24956,
    -23932,-22908,-21884,-20860,-19836,-18812,-17788,-16764,
    -15996,-15484,-14972,-14460,-13948,-13436,-12924,-12412,
    -11900,-11388,-10876,-10364, -9852, -9340, -8828, -8316,
     -7932, -7676, -7420, -7164, -6908, -6652, -6396, -6140,
     -5884, -5628, -5372, -5116, -4860, -4604, -4348, -4092,
     -3900, -3772, -3644, -3516, -3388, -3260, -3132, -3004,
     -2876, -2748, -2620, -2492, -2364, -2236, -2108, -1980,
     -1884, -1820, -1756, -1692, -1628, -1564, -1500, -1436,
     -1372, -1308, -1244, -1180, -1116, -1052,  -988,  -924,
      -876,  -844,  -812,  -780,  -748,  -716,  -684,  -652,
      -620,  -588,  -556,  -524,  -492,  -460,  -428,  -396,
      -372,  -356,  -340,  -324,  -308,  -292,  -276,  -260,
      -244,  -228,  -212,  -196,  -180,  -164,  -148,  -132,
      -120,  -112,  -104,   -96,   -88,   -80,   -72,   -64,
       -56,   -48,   -40,   -32,   -24,   -16,    -8,     0,
     32124, 31100, 30076, 29052, 28028, 27004, 25980, 24956,
     23932, 22908, 21884, 20860, 19836, 18812, 17788, 16764,
     15996, 15484, 14972, 14460, 13948, 13436, 12924, 12412,
     11900, 11388, 10876, 10364,  9852,  9340,  8828,  8316,
      7932,  7676,  7420,  7164,  6908,  6652,  6396,  6140,
      5884,  5628,  5372,  5116,  4860,  4604,  4348,  4092,
      3900,  3772,  3644,  3516,  3388,  3260,  3132,  3004,
      2876,  2748,  2620,  2492,  2364,  2236,  2108,  1980,
      1884,  1820,  1756,  1692,  1628,  1564,  1500,  1436,
      1372,  1308,  1244,  1180,  1116,  1052,   988,   924,
       876,   844,   812,   780,   748,   716,   684,   652,
       620,   588,   556,   524,   492,   460,   428,   396,
       372,   356,   340,   324,   308,   292,   276,   260,
       244,   228,   212,   196,   180,   164,   148,   132,
       120,   112,   104,    96,    88,    80,    72,    64,
        56,    48,    40,    32,    24,    16,     8,     0
};


/*
        13bit PCM         A-law
  ----------------    ----------
  s 0000 000a bcd-    s 000 abcd
  s 0000 001a bcd-    s 001 abcd
  s 0000 01ab cd--    s 010 abcd
  s 0000 1abc d---    s 011 abcd
  s 0001 abcd ----    s 100 abcd
  s 001a bcd- ----    s 101 abcd
  s 01ab cd-- ----    s 110 abcd
  s 1abc d--- ----    s 111 abcd
*/
static inline unsigned char l2a(short pcm)
{
    unsigned int _pcm;
    unsigned char invert;
    int seg;


    if (0 > pcm)
    {
        _pcm = -pcm;
        invert = 0x55;
    }
    else
    {
        _pcm = pcm;
        invert = 0xd5;
    }

    if ((0x0020 << 3) > _pcm)
        seg = 0;
    else if ((0x0040 << 3) > _pcm)
        seg = 1;
    else if ((0x0080 << 3) > _pcm)
        seg = 2;
    else if ((0x0100 << 3) > _pcm)
        seg = 3;
    else if ((0x0200 << 3) > _pcm)
        seg = 4;
    else if ((0x0400 << 3) > _pcm)
        seg = 5;
    else if ((0x0800 << 3) > _pcm)
        seg = 6;
    else if ((0x1000 << 3) > _pcm)
        seg = 7;
    else
        return 0x7f ^ invert;

    if (0 == seg)
        return (_pcm >> 4) ^ invert;
    else
        return ((seg << 4) | ((_pcm >> (seg + 3)) & 0x0f)) ^ invert;
}
static inline short a2l(unsigned char a)
{
    unsigned char seg;
    unsigned short pcm;

    a ^= 0x55;
    seg = (a & 0x70) >> 4;

    if (0 == seg)
        pcm = (((unsigned short)(a & 0x0f)) << 4) | 0x08;
    else
        pcm = ((((unsigned short)(a & 0x0f)) << 3) | 0x84) << seg;

    if (a & 0x80)
        return (short)pcm;
    else
        return -((short)pcm);
}

void g711a_encode(const short *pcm, int cnt, unsigned char *out)
{
    int i;

    if (NULL == pcm || NULL == out)
        return;

    for (i = 0; i < cnt; i++)
    {
        out[i] = l2a(pcm[i]);
    }
}
void g711a_decode(const unsigned char *a, int cnt, short *out)
{
    int i;

    if (NULL == a || NULL == out)
        return;

    for (i = 0; i < cnt; i++)
    {
        out[i] = a2l_map[a[i]];
    }
}


/*
          14bit PCM         u-law
  ------------------    ----------
  s 0 0000 001a bcd-    s 000 abcd
  s 0 0000 01ab cd--    s 001 abcd
  s 0 0000 1abc d---    s 010 abcd
  s 0 0001 abcd ----    s 011 abcd
  s 0 001a bcd- ----    s 100 abcd
  s 0 01ab cd-- ----    s 101 abcd
  s 0 1abc d--- ----    s 110 abcd
  s 1 abcd ---- ----    s 111 abcd
*/
static inline unsigned char l2u(short pcm)
{
    unsigned int _pcm;
    unsigned char invert;
    int seg;


    if (0 > pcm)
    {
        _pcm = -pcm;
        invert = 0x7f;
    }
    else
    {
        _pcm = pcm;
        invert = 0xff;
    }
    _pcm += (33 << 2);

    if ((0x0040 << 2) > _pcm)
        seg = 0;
    else if ((0x0080 << 2) > _pcm)
        seg = 1;
    else if ((0x0100 << 2) > _pcm)
        seg = 2;
    else if ((0x0200 << 2) > _pcm)
        seg = 3;
    else if ((0x0400 << 2) > _pcm)
        seg = 4;
    else if ((0x0800 << 2) > _pcm)
        seg = 5;
    else if ((0x1000 << 2) > _pcm)
        seg = 6;
    else if ((0x2000 << 2) > _pcm)
        seg = 7;
    else
        return 0x7f ^ invert;

    return ((seg << 4) | ((_pcm >> (seg + 3) & 0x0f))) ^ invert;
}
static inline short u2l(unsigned char a)
{
    unsigned char seg;

    a = ~a;
    seg = (a & 0x70) >> 4;

    if (a & 0x80)
        return -((((((unsigned short)(a & 0x0f)) << 3) | 0x84) << seg) - (33 << 2));
    else
        return (((((unsigned short)(a & 0x0f)) << 3) | 0x84) << seg) - (33 << 2);
}

void g711u_encode(const short *pcm, int cnt, unsigned char *out)
{
    int i;

    if (NULL == pcm || NULL == out)
        return;

    for (i = 0; i < cnt; i++)
    {
        out[i] = l2u(pcm[i]);
    }
}
void g711u_decode(const unsigned char *u, int cnt, short *out)
{
    int i;

    if (NULL == u || NULL == out)
        return;

    for (i = 0; i < cnt; i++)
    {
        out[i] = u2l_map[u[i]];
    }
}
